# Tutorial: Adding a New Domain or Updating Existing Data in Austros ATLA World Encyclopedia

This guide walks you through the process of adding a brand new data domain (such as "avatar calligraphy") or updating existing sections (e.g., adding a missing character like Mai to nonbenders), ensuring all changes are fully integrated into the data pipeline, search, and UIâ€”just like existing sections.

---

## 1. Prepare Raw Data & Schema
### Adding a New Domain
- **Create a new folder:**
  - `/raw-data/{your-domain}/`
- **Add your raw data:**
  - Write one or more `.json` files (e.g., `calligraphy.json`) with your records.
  - Optionally, add `.md` files for each entry for richer content.
- **Define a schema:**
  - Add `/raw-data/schema/{your-domain}.schema.json` describing the structure of your records (fields, types, required properties).

### Updating Existing Sections (e.g., Adding Mai to Nonbenders)
- **Locate the relevant file:**
  - For example, `/raw-data/nonbending/nonbending data.json`.
- **Add or update the record:**
  - Insert a new object for Mai, ensuring all required fields (as per the schema) are present.
  - If using Markdown, add a new `.md` file and run the extraction script (see below).
- **(Optional) Update Markdown:**
  - Add or edit `.md` files in the relevant directory.

## 2. (Optional) Markdown Extraction
- If you have `.md` files, run:
  - `node scripts/convert-md-to-json.mjs`
- This will convert Markdown files to `.json` in the same directory, extracting frontmatter and body.

## 3. Update Enrichment Config (If Needed)
- Open `/scripts/enrich-config.mjs`.
- For new domains, add enrichment rules.
- For existing domains, update rules if new fields or relations are needed.

## 4. Validate Data
- Run:
  - `npm run validate:data`
- This checks your new or updated data against the schema. Fix any errors reported.

## 5. Enrich Data
- Run:
  - `npm run enrich:data`
- This adds synonyms, tags, relations, and slugs to your new or updated records.
- Errors are logged and problematic records are skipped.

## 6. Build Search Index
- Run:
  - `npm run build:index`
- This updates `/dist/search-index.json` to include your new or updated data.

## 7. Copy Artifacts to Public
- Copy `/dist/enriched-data.json` and `/dist/search-index.json` to `/public/`:
  - `cp dist/enriched-data.json public/enriched-data.json`
  - `cp dist/search-index.json public/search-index.json`

## 8. Add or Update Types (TypeScript)
- For new domains, update `/src/types/rawTypes.ts` and `/src/types/domainTypes.ts`.
- For existing domains, ensure any new fields are reflected in the types.
- Export these types via `/src/types/index.ts`.

## 9. Add or Update UI Components & Pages
- For new domains, create new pages and detail views in `/src/pages/`.
- For existing domains, ensure the new data appears in the relevant list and detail pages.
- Update routing in `src/router.tsx` if new pages are added.

## 10. Connect to Search & Filters
- For new domains, update search/filter logic in `/src/search/ClientSearchEngine.ts` and hooks.
- For existing domains, verify that new data is searchable and filterable.

## 11. Test & Validate
- Start the dev server and verify:
  - New or updated data appears in search and navigation.
  - Detail pages hydrate correctly by slug.
  - 404s and error states are handled gracefully.

## 12. Document & Commit
- Update `/docs/setup.md` and `/docs/decisions.md` to mention your changes.
- Commit your changes and push.

---

## Example: Adding "Mai" to Nonbenders
1. Edit `/raw-data/nonbending/nonbending data.json` and add a new object for Mai, following the schema.
2. (Optional) Add `/raw-data/nonbending/mai.md` for richer content.
3. Run the validation, enrichment, and index scripts.
4. Copy updated artifacts to `/public/`.
5. Verify Mai appears in the UI and is accessible by slug.

---

**Best Practices:**
- Keep each file and component focused on a single responsibility (SRP).
- Always use slugs for navigation and hydration.
- Validate and enrich data before building the index.
- Document every new domain or update for future maintainers.

---

*Last updated: [auto-generated by Cursor]*
