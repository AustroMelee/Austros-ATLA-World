# Austros ATLA World Encyclopedia – Setup & Workflow Guide

## Project Overview
Austros ATLA World Encyclopedia is a static, client-only React/TypeScript application for exploring the world of Avatar: The Last Airbender. It features a robust, slug-native data pipeline, type-safe UI, and a fully automated build process.

---

## Step-by-Step Workflow (Steps 1–10.5)

### 1. Project Foundations
- Project structure and blueprints are documented in `/docs/blueprints/`.
- All raw data is stored in `/raw-data/` (JSON and Markdown).

### 2. Repository Initialization
- Folder structure: `/src/`, `/scripts/`, `/dist/`, `/public/`, `/tests/`, `/docs/`.
- `README.md` provides a project overview.
- `.gitignore` excludes `/dist/` and `node_modules/`.

### 3. Core App & Build Setup
- Vite + React + TypeScript + vanilla-extract for styling.
- `vite.config.ts` handles static assets and PWA support.
- Routing via React Router in `src/router.tsx`.

### 4. Data Validation
- `scripts/validate-data.mjs` validates all `/raw-data/*.json` files against schemas in `/raw-data/schema/` using Zod.
- Run with: `npm run validate:data`
- Fails on any schema error; logs detailed errors.

### 5. Data Enrichment
- `scripts/enrich-data.mjs` enriches validated data with synonyms, tags, and relations per `/scripts/enrich-config.mjs`.
- Output: `/dist/enriched-data.json` (fully regenerated each run).
- Errors are logged and skipped, not fatal.

### 5.5. Markdown-to-JSON Extraction
- `scripts/convert-md-to-json.mjs` converts Markdown files in `/raw-data/{type}/` to JSON.
- YAML frontmatter is parsed; body is stored as `body`.
- Output: `.json` files in the same directory.

### 6. Search Index Build
- `scripts/build-index.mjs` creates `/dist/search-index.json` using FlexSearch.
- Indexes `name`, `synonyms`, `tags`, `relations`.
- Output includes a FlexSearch index and a slug-keyed record map.

### 6.5. Styling Migration
- All styling uses vanilla-extract (`.css.ts` files in `/src/components/`).
- Tailwind CSS is fully removed.

### 7. Types & Validation
- `/src/types/rawTypes.ts` matches raw data.
- `/src/types/domainTypes.ts` matches enriched data.
- All scripts and components use these types for safety.

### 8. Component Scaffolding
- Core UI components in `/src/components/` (SRP-compliant, one file per responsibility).
- Each has a matching `.css.ts` file for styles.

### 9. Hooks
- Custom hooks in `/src/hooks/` for search, debounce, and virtual scroll.

### 10. Pages & Routing
- Pages in `/src/pages/` for each domain.
- Routing is slug-based; all navigation uses slugs.

### 10.5. Entity Detail Views
- Dedicated detail pages for each entity type (e.g., `/characters/:slug`).
- Hydration and navigation are strictly slug-based.
- 404 handling is robust and user-friendly.

---

## Data Pipeline & Slug System
- All entities are assigned a unique, deterministic, URL-safe slug at enrichment time.
- All lookups, navigation, and hydration use slugs only.
- Slug collisions are detected and resolved at build time.
- Data and index files are copied to `/public/` for client access after each build.

---

## How to Regenerate/Copy Data
1. Run: `npm run validate:data && npm run enrich:data && npm run build:index`
2. Copy `/dist/enriched-data.json` and `/dist/search-index.json` to `/public/`.
3. Confirm both files exist and are up to date.

---

## Troubleshooting
- **Missing/duplicate slugs:** Check enrichment config and raw data for errors.
- **404s on detail pages:** Ensure the slug exists in both data and index files.
- **Build errors:** Review logs for schema or enrichment issues.

---

## Best Practices & SRP Compliance
- Each script, component, and page has a single responsibility.
- All types are strictly defined and imported.
- No business logic is duplicated across files.
- All navigation and hydration is slug-based for consistency and future-proofing.

---

## For More Details
- See `/docs/decisions.md` for architectural rationale and slug-native design.
- See `/docs/blueprints/` for the original project plan and requirements.

---

*Last updated: [auto-generated by Cursor]*
