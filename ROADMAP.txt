“curb stomp” mechanics are essential for any serious tactical sim that wants to feel true to the source, and create stakes where skill or power disparity is real. You want Ozai vs Sokka to last two turns, not twenty; you want “Azula’s Lightning” to be a duel-ender against Aang if it lands clean. Here’s how to implement curb stomp logic—with tactical depth, fairness, and drama, plus narrative support.

1. Data Model: Add Curb Stomp Triggers to Moves & Characters
A. Move Definitions
ts
Copy
Edit
type MoveInstance = {
  id: string;
  name: string;
  curbStomp?: {
    vs: PlayerId[];          // Array of character IDs this triggers against
    onHit: boolean;          // true = triggers if move hits
    condition?: (ctx: BattleContext) => boolean; // Extra conditions (e.g., "not shielded")
    flavor?: string | ((ctx: BattleContext) => string); // Optional custom KO line
  };
  // ...other fields
};
Example:

ts
Copy
Edit
{
  id: "lightning",
  name: "Lightning",
  requiresCharge: true,
  curbStomp: {
    vs: ["aang"],
    onHit: true,
    condition: ctx => !ctx.target.statuses.includes("shielded"), // Must not be shielded
    flavor: ctx => "Azula’s lightning arcs into Aang—a single, blinding instant. The battle is over."
  }
}
B. Character Weakness Profiles
You may also want per-character “curbStompable” fields for very weak matchups (e.g. Sokka vs Ozai).

ts
Copy
Edit
type CharacterProfile = {
  id: PlayerId;
  curbStompedBy?: MoveId[]; // Moves that will 1-shot this character
  // ...other fields
};
2. Battle Logic: Detect and Enforce Curb Stomp Events
In damage calculation/resolve phase:

When a move hits, check if curbStomp exists and applies to the current opponent (vs).

If condition passes, override normal damage/KO:

Set target HP to zero, trigger instant KO (or special “curbStomp” resolution event).

Optionally, skip further turns (unless you want a dramatic “collapse” phase).

Add flavor text from curbStomp.flavor.

Pseudocode:

ts
Copy
Edit
function resolveMove(move, actor, target, ctx) {
  if (move.curbStomp && move.curbStomp.vs.includes(target.id)) {
    if (
      (!move.curbStomp.condition || move.curbStomp.condition(ctx)) &&
      (move.curbStomp.onHit && ctx.hit)
    ) {
      target.hp = 0;
      ctx.log.push({
        type: "CURB_STOMP",
        actor: actor.id,
        target: target.id,
        desc: typeof move.curbStomp.flavor === "function"
          ? move.curbStomp.flavor(ctx)
          : move.curbStomp.flavor || `${actor.name} utterly overwhelms ${target.name}!`,
        // ...more meta
      });
      return;
    }
  }
  // ...normal damage calculation
}
3. Narrative Integration
Add unique flavor lines on curb stomp, e.g.:

“Azula’s lightning arcs into Aang—a single, blinding instant. The battle is over.”

“Ozai sweeps Sokka aside without a second glance.”

“There was never any contest.”

Optional:

If not instant, but a massive advantage exists (Aang full HP, Sokka 10 HP), you can trigger a “mercy” state or unique surrender event.

4. UI/Replay Impact
Highlight curb stomp with special animation or banner (“Instant Victory!” / “Decisive Overwhelm!”)

In battle log, flag curb stomp events.

In stats/analytics, track curb stomp outcomes.

5. AI/Behavior Considerations
The AI should know when it has access to a curb stomp move and prioritize it (for drama, not sandbagging).

Conversely, an AI facing instant defeat might desperately shield, dodge, or reposition to avoid the fatal hit.

6. Testing & Edge Cases
Always test:

Can a character “cheese” a curb stomp every time? (Prevent cheapness unless intentional)

Is the curb stomp interruptible? (e.g., if Aang shields, Lightning should not end him)

Does narrative fire only once, and is the UI dramatic enough?

Inverse: Some matchups (e.g., Aang vs random Fire Nation guard) can have a “curb stomp” from Aang’s side too.

Optional Extensions
Mercy Mechanic: If AI is hopelessly outmatched, can surrender or beg for quarter (with unique dialogue).

Desperation Override: On rare narrative grounds, a player might survive a curb stomp (once per story arc, etc.)—this is for special Avatar moments only.

TL;DR Steps
Annotate moves with curbStomp triggers (including vs, condition, flavor).

Battle logic detects and executes curb stomp on hit, bypassing normal KO.

Narrative/UI makes it unmistakable and dramatic.

Test and balance for fairness, drama, and story-faithfulness.









Feature	Status	Notes/Evidence
Cooldown/Use Limits	❌	“Wind Slice,” “Air Blast,” “Blue Fire,” “Basic Strike” all appear multiple times in a row; no per-move cooldown seen.
Chi/Energy Management	✅	Every special move logs chi cost; fallback to Basic Strike when chi is low (“Aang (2 chi) resorts to a basic physical strike, conserving their energy!”).
Critical Hits (Combat)	✅	“CRITICALLY hits Azula, dealing 1 damage!” and “CRITICALLY hits Aang, dealing 1 damage!” seen for both sides.
Critical Hits (Visual/Highlight)	⚠️	Crits called out in text, but no log highlight (color/icon); still just words.
Desperation/Finisher Moves	❌	No finisher or high-impact end moves. All attacks deal 1 damage, even crits.
Stalemate Prevention	✅	Hard-coded “max_turns” at 50, triggers battle end.
Adaptive Pattern Recognition (AI)	❌	Both fighters spam same moves repeatedly. No “don’t repeat last move” or AI adjustment.
Personality-Driven Dialogue (AI)	✅	Improved: Azula uses banter (“Your bending is pathetic.” “You can't stop me!” “I don't need chi to destroy you.”) and Aang uses “I’m sorry…”, “I can do this!”.
AI Fallback/Failover	✅	Basic Strike is used when chi is low; fallback works as expected.
Event-Triggered Narratives	✅	Strong narrator flavor: “First blood is drawn.” “The strike cuts through…” “Air crackles with elemental energy.” “Momentum builds…”
Unique Per-Character Flavor	✅	Aang and Azula both have in-character dialogue. Narrator also adds flavor.
Dynamic Narrator	✅	Wide range: opener, phase change, energy, critical commentary, battle climax, fatigue.
Log Visual Highlighting	❌	Still plaintext—no color, icon, or bolding for crits, buffs, or key moments.
Finisher Visual Cues	❌	None; fight ends flat on turn cap (“battle has dragged on too long”).
Status Bar/Buffs	✅	Air Shield now logs as “Aang’s defense rises by 15 (3 turns)!” Buff duration is shown, and not infinitely stacked every turn.
Data-Driven Moves/Actors	❌	No evidence of config-driven or JSON-based moves in the logs.
Testing/Analytics	❌	No end-of-battle stat summary, move counts, or performance analysis.
Resource Scarcity Pressure	✅	Chi depletion, fallback to basics, narrator lines about energy and exhaustion.

