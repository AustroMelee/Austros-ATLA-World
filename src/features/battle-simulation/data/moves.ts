// @docs
// @description: SINGLE SOURCE OF TRUTH for all moves in Avatar Battle Arena. Registry/data-driven, plug-and-play architecture. No hard-coded logic. Extensible via data only. SRP-compliant. See SYSTEM ARCHITECTURE.MD for integration points.
// @criticality: 🗂️ Data
// @owner: AustroMelee
// @tags: moves, data, registry, plug-and-play, extensibility, SRP
//
// All moves must be added here and referenced by ID in character data. No engine changes required for new moves.
//
// Updated for 2025 registry-driven architecture overhaul.
// @file moves.ts
// @description SINGLE SOURCE OF TRUTH. A unified, data-driven registry for ALL moves in the game.
// This decouples move definitions from character-specific files, enabling true scalability.
// Adding a new move only requires adding a new object to this array.

import type { Move } from '../types/move.types';

export const ALL_MOVES: Move[] = [
  // --- NEW GENERIC MOVE ---
  {
    id: 'gather_power',
    name: 'Gather Power',
    type: 'defense_buff', // Classified as a buff since it improves state
    chiCost: 0,
    baseDamage: 0,
    cooldown: 1, // Add a 1-turn cooldown to prevent spamming
    description: 'The user focuses, gathering their energy and restoring 3 Chi. Skips the turn.',
    tags: ['utility', 'recovery'],
  },
  // Aang's Moves
  {
    id: 'aang_basic_strike',
    name: 'Basic Strike',
    type: 'attack',
    chiCost: 0,
    baseDamage: 1,
    cooldown: 0,
    critChance: 0.12,
    critMultiplier: 3,
    description: 'Aang delivers a quick, focused physical blow.',
    punishIfCharging: true,
    tags: ['basic']
  },
  {
    id: 'aang_air_glide',
    name: 'Air Glide',
    type: 'defense_buff',
    chiCost: 1,
    baseDamage: 0,
    cooldown: 1,
    changesPosition: "repositioning",
    repositionSuccessRate: 0.9,
    environmentalConstraints: ["Open", "Air-Friendly"],
    description: 'Aang glides through the air to reposition himself.',
  },
  {
    id: 'aang_air_tornado',
    name: 'Air Tornado',
    type: 'attack',
    chiCost: 7,
    baseDamage: 3,
    cooldown: 3,
    critChance: 0.18,
    critMultiplier: 2.5,
    desperationBuff: { hpThreshold: 25, damageBonus: 2, defensePenalty: 5 },
    description: 'Aang summons a swirling tornado of air to batter his foe.',
    requiresPosition: ["neutral", "flying", "high_ground"],
    collateralDamage: 2,
    collateralDamageNarrative: "The force of the cyclone rips cobblestones from the ground and sends debris flying through the plaza.",
  },
  {
    id: 'aang_wind_slice',
    name: 'Wind Slice',
    type: 'attack',
    chiCost: 5,
    baseDamage: 4,
    cooldown: 2,
    critChance: 0.15,
    critMultiplier: 2,
    description: 'A razor-sharp blade of wind that cuts through defenses.',
    requiresPosition: ["aggressive", "neutral"],
    appliesEffect: {
      type: 'DEFENSE_DOWN',
      chance: 0.5,
      duration: 2,
      potency: 3
    },
  },
  {
    id: 'aang_air_shield',
    name: 'Air Shield',
    type: 'defense_buff',
    chiCost: 4,
    baseDamage: 0,
    cooldown: 4,
    description: 'A swirling barrier of air that boosts defense for 2 turns.',
    changesPosition: "defensive",
    appliesEffect: {
      type: 'DEFENSE_UP',
      chance: 1.0,
      duration: 2,
      potency: 5
    },
  },
  {
    id: 'aang_charged_tornado',
    name: 'Charged Air Tornado',
    type: 'charge',
    chiCost: 8,
    baseDamage: 0,
    cooldown: 8,
    maxUses: 1,
    isChargeUp: true,
    chargeTime: 1,
    requiresPosition: ["neutral", "flying"],
    onlyIfEnemyState: ["repositioning", "stunned", "charging"],
    environmentalConstraints: ["Desert", "Open"],
    canBeInterrupted: true,
    chargeInterruptionPenalty: 5,
    description: 'Aang channels immense airbending power into a devastating tornado. Only usable when opponent is vulnerable.',
    collateralDamage: 3,
    collateralDamageNarrative: "The force of the cyclone rips cobblestones from the ground and shatters the facades of nearby buildings.",
    tags: ['finisher', 'escalation', 'lastResort'],
    finisherCondition: { type: 'custom', isAvailable: (ctx) => ctx.selfHP > 0 && ctx.selfPosition === 'charging' && ctx.selfHP <= ctx.selfMaxHP && ctx.selfHP > 0 },
    releaseMoveId: 'aang_charged_tornado_release'
  },
  {
    id: 'aang_charged_tornado_release',
    name: 'Air Tornado Blast',
    type: 'attack',
    chiCost: 0,
    baseDamage: 35,
    cooldown: 0,
    maxUses: 1,
    description: 'Aang unleashes the full force of his charged tornado in a devastating blast.',
    tags: ['finisher', 'escalation', 'lastResort'],
    collateralDamage: 3,
    collateralDamageNarrative: 'The tornado blast devastates the battlefield.'
  },
  {
    id: 'aang_last_breath_cyclone',
    name: 'Last Breath Cyclone',
    type: 'attack',
    chiCost: 10,
    baseDamage: 36, // High damage for finisher
    cooldown: 0,
    maxUses: 1,
    isFinisher: true,
    oncePerBattle: true,
    finisherCondition: { type: 'hp_below', percent: 20 },
    description: 'Aang channels every last ounce of strength into a world-shaking cyclone. A battle-ending move.',
    collateralDamage: 3,
    tags: ['finisher', 'lastResort']
  },
  {
    id: 'aang_flowing_evasion',
    name: 'Flowing Evasion',
    type: 'evade',
    chiCost: 4,
    baseDamage: 0,
    cooldown: 3,
    maxUses: 4,
    description: 'Aang uses airbending to become like the wind, flowing around attacks with graceful evasion.',
    changesPosition: "defensive",
  },
  // Azula's Moves
  {
    id: 'azula_basic_strike',
    name: 'Basic Strike',
    type: 'attack',
    chiCost: 0,
    baseDamage: 1,
    cooldown: 0,
    critChance: 0.10,
    critMultiplier: 2.5,
    description: 'Azula delivers a precise, calculated strike.',
    punishIfCharging: true,
    tags: ['basic']
  },
  {
    id: 'azula_blue_fire',
    name: 'Blue Fire',
    type: 'attack',
    chiCost: 3,
    baseDamage: 3,
    cooldown: 2,
    critChance: 0.15,
    critMultiplier: 2.5,
    description: 'Azula unleashes her signature blue flames.',
    requiresPosition: ["aggressive", "neutral"],
    appliesEffect: {
      type: 'BURN',
      chance: 1.0,
      duration: 3,
      potency: 2
    },
    collateralDamage: 1,
  },
  {
    id: 'azula_fire_dash',
    name: 'Fire Dash',
    type: 'defense_buff',
    chiCost: 2,
    baseDamage: 0,
    cooldown: 2,
    changesPosition: "repositioning",
    repositionSuccessRate: 0.7,
    environmentalConstraints: ["Open", "Fire-Friendly"],
    description: 'Azula uses fire propulsion to quickly reposition.',
  },
  {
    id: 'azula_lightning',
    name: 'Lightning',
    type: 'charge',
    chiCost: 10,
    baseDamage: 0,
    cooldown: 10,
    maxUses: 1,
    isChargeUp: true,
    chargeTime: 1,
    onlyIfEnemyState: ["repositioning", "stunned", "charging"],
    canBeInterrupted: true,
    chargeInterruptionPenalty: 8,
    description: 'Azula channels lightning. Only usable when opponent is vulnerable.',
    collateralDamage: 2,
    tags: ['finisher', 'escalation', 'lastResort'],
    finisherCondition: { type: 'custom', isAvailable: (ctx) => ctx.selfHP > 0 && ctx.selfPosition === 'charging' && ctx.selfHP <= ctx.selfMaxHP && ctx.selfHP > 0 },
    releaseMoveId: 'azula_lightning_release'
  },
  {
    id: 'azula_lightning_release',
    name: 'Lightning Strike',
    type: 'attack',
    chiCost: 0,
    baseDamage: 38,
    cooldown: 0,
    maxUses: 1,
    description: 'Azula unleashes a devastating lightning strike after charging.',
    tags: ['finisher', 'escalation', 'lastResort'],
    collateralDamage: 2,
    collateralDamageNarrative: 'The lightning strike scorches the battlefield.'
  },
  {
    id: 'azula_fire_shield',
    name: 'Fire Shield',
    type: 'defense_buff',
    chiCost: 4,
    baseDamage: 0,
    cooldown: 4,
    description: 'A protective barrier of blue flames.',
    changesPosition: "defensive",
  },
  {
    id: 'azula_relentless_assault',
    name: 'Relentless Assault',
    type: 'attack',
    chiCost: 6,
    baseDamage: 5,
    cooldown: 5,
    description: 'A rapid series of fire attacks.',
    requiresPosition: ["aggressive"],
  },
  {
    id: 'azula_blazing_counter',
    name: 'Blazing Counter',
    type: 'parry_retaliate',
    chiCost: 5,
    baseDamage: 20,
    cooldown: 4,
    maxUses: 3,
    description: 'Azula uses a precise blast of fire to intercept an attack and create an opening for a devastating counter.',
    changesPosition: "defensive",
  },
  {
    id: 'azula_phoenix_inferno',
    name: 'Phoenix Inferno',
    type: 'attack',
    chiCost: 12,
    baseDamage: 40, // High damage for finisher
    cooldown: 0,
    maxUses: 1,
    isFinisher: true,
    oncePerBattle: true,
    finisherCondition: { type: 'hp_below', percent: 20 },
    description: 'Azula channels all remaining energy into a devastating final attack. A battle-ending move.',
    collateralDamage: 3,
    tags: ['finisher', 'lastResort']
  },
  // --- AANG: Escalation Moves ---
  {
    id: 'aang_whirlwind_barrage',
    name: 'Whirlwind Barrage',
    type: 'attack',
    chiCost: 4,
    baseDamage: 16,
    cooldown: 2,
    description: 'Aang unleashes a flurry of air strikes, overwhelming his foe with relentless speed.',
    tags: ['escalation'],
    appliesEffect: {
      type: 'DEFENSE_DOWN',
      chance: 1.0,
      duration: 1,
      potency: 5
    },
  },
  {
    id: 'aang_tempest_step',
    name: 'Tempest Step',
    type: 'evade',
    chiCost: 3,
    baseDamage: 0,
    cooldown: 2,
    description: 'Aang dodges with supernatural agility, repositioning for advantage.',
    tags: ['escalation', 'reposition'],
  },
  // --- AANG: Desperation Moves ---
  {
    id: 'aang_razor_gale',
    name: 'Razor Gale',
    type: 'attack',
    chiCost: 5,
    baseDamage: 22,
    cooldown: 3,
    description: 'A desperate burst of slicing wind. If it misses, Aang’s next defense is penalized.',
    unlockCondition: { type: 'health', threshold: 30 },
    tags: ['desperation'],
  },
  {
    id: 'aang_vault_of_air',
    name: 'Vault of Air',
    type: 'evade',
    chiCost: 6,
    baseDamage: 0,
    cooldown: 4,
    description: 'Aang launches himself skyward, avoiding all attacks this turn.',
    unlockCondition: { type: 'health', threshold: 30 },
    tags: ['desperation', 'defense'],
  },
  // --- AANG: Finisher/Last-Resort Moves ---
  {
    id: 'aang_last_breath_cyclone',
    name: 'Last Breath Cyclone',
    type: 'attack',
    chiCost: 10,
    baseDamage: 36,
    cooldown: 0,
    description: 'Aang’s ultimate technique—a colossal tornado unleashed with his final reserves.',
    isFinisher: true,
    finisherCondition: { type: 'hp_below', percent: 20 },
    tags: ['finisher', 'last-resort'],
  },
  {
    id: 'aang_avatars_resilience',
    name: 'Avatar’s Resilience',
    type: 'defense_buff',
    chiCost: 0,
    baseDamage: 0,
    cooldown: 99,
    description: 'In a moment of crisis, Aang channels inner peace, restoring some vitality.',
    oncePerBattle: true,
    tags: ['last-resort', 'recovery'],
  },
  // --- AZULA: Escalation Moves ---
  {
    id: 'azula_inferno_cascade',
    name: 'Inferno Cascade',
    type: 'attack',
    chiCost: 5,
    baseDamage: 17,
    cooldown: 2,
    description: 'Azula unleashes a series of controlled blue fire bursts, pressing the attack with relentless precision.',
    tags: ['escalation'],
    appliesEffect: {
      type: 'DEFENSE_DOWN',
      chance: 1.0,
      duration: 1,
      potency: 3
    },
  },
  {
    id: 'azula_lightning_feint',
    name: 'Lightning Feint',
    type: 'parry_retaliate',
    chiCost: 6,
    baseDamage: 6,
    cooldown: 2,
    description: 'Azula channels lightning but uses it as a feint, leaving her foe exposed.',
    tags: ['escalation', 'tactical'],
  },
  // --- AZULA: Desperation Moves ---
  {
    id: 'azula_combustion_rush',
    name: 'Combustion Rush',
    type: 'attack',
    chiCost: 7,
    baseDamage: 23,
    cooldown: 3,
    description: 'Azula channels her remaining strength into a reckless, explosive charge.',
    unlockCondition: { type: 'health', threshold: 30 },
    tags: ['desperation'],
  },
  {
    id: 'azula_steel_nerve',
    name: 'Steel Nerve',
    type: 'defense_buff',
    chiCost: 0,
    baseDamage: 0,
    cooldown: 4,
    description: 'Azula enters a trance-like focus, shrugging off status effects and restoring some composure.',
    unlockCondition: { type: 'health', threshold: 30 },
    tags: ['desperation', 'recovery'],
  },
  // --- AZULA: Finisher/Last-Resort Moves ---
  {
    id: 'azula_phoenix_inferno',
    name: 'Phoenix Inferno',
    type: 'attack',
    chiCost: 12,
    baseDamage: 38,
    cooldown: 0,
    description: 'Azula unleashes her signature, all-consuming blue fire, aiming to end the battle in a single devastating display.',
    isFinisher: true,
    finisherCondition: { type: 'hp_below', percent: 20 },
    tags: ['finisher', 'last-resort'],
  },
  {
    id: 'azula_cold_precision',
    name: 'Cold Precision',
    type: 'attack',
    chiCost: 8,
    baseDamage: 19,
    cooldown: 99,
    description: 'With absolute clarity, Azula executes a flawless, surgically precise attack.',
    oncePerBattle: true,
    tags: ['last-resort', 'precision'],
  },
];

// Helper to get a move by ID
export function getMoveById(id: string) {
  return ALL_MOVES.find(m => m.id === id);
} 